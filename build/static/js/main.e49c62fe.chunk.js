(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){"use strict";(function(e){var a=n(37),r=n(2),c=n.n(r),i=n(138),s=n(6),o=n(9),u=n(10),l=n(12),p=n(11),h=n(13),d=n(3),f=n(0),m=n.n(f),v=n(16),b=n(305),g=n(55),y=n(34),O=n(14),E=n(32),k=[{path:"/apps",sidebar:y.e,main:y.a},{path:"/devices",sidebar:y.e,main:y.b},{path:"/settings",sidebar:y.e,main:y.d}],j=function(t){function r(){var e;return Object(o.a)(this,r),(e=Object(l.a)(this,Object(p.a)(r).call(this))).dbMasqPrivate=null,e.dbMasqPublic=null,e.dbs={},e.sw=null,e.state={messages:[],hash:null},e.handleInput=e.handleInput.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(r,t),Object(u.a)(r,[{key:"componentDidMount",value:function(){var t=Object(s.a)(c.a.mark(function t(){var a,r,s,o,u,l,p,h,d,f;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.props.devices.length||(a=n(297).detect(),r=a.name,s=a.os,this.props.addDevice({name:"".concat(r," sur ").concat(s),description:"Cet appareil",color:"#40ae6c"})),(o=window.location.hash.substr(2)).length){t.next=4;break}return t.abrupt("return");case 4:u=e.from(o,"base64");try{l=JSON.parse(u),p=Object(i.a)(l,4),h=p[0],p[1],d=p[2],f=p[3],this.props.setCurrentAppRequest({appId:h,channel:d,key:f})}catch(c){}case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"appendMessage",value:function(e){this.setState({messages:[].concat(Object(a.a)(this.state.messages),[e])})}},{key:"handleInput",value:function(e){this.setState({input:e.target.value})}},{key:"render",value:function(){var e=this,t=this.props,n=t.currentUser,a=t.currentAppRequest;return m.a.createElement(b.a,null,m.a.createElement("div",null,n&&a&&m.a.createElement(E.b,{onClose:function(){return e.props.setCurrentAppRequest(null)},appRequest:a}),m.a.createElement(g.a,{path:"/",component:y.c}),m.a.createElement("div",{style:{display:"flex"}},k.map(function(e,t){return m.a.createElement(g.a,{key:t,path:e.path,component:e.sidebar})}),k.map(function(e,t){return m.a.createElement(g.a,{key:t,path:e.path,component:e.main})}))))}}]),r}(f.Component);t.a=Object(v.b)(function(e){return{currentAppRequest:e.masq.currentAppRequest,currentUser:e.masq.currentUser,devices:e.masq.devices,users:e.masq.users}},function(e){return{addDevice:function(t){return e(Object(O.a)(t))},setCurrentAppRequest:function(t){return e(Object(O.f)(t))}}})(j)}).call(this,n(5).Buffer)},137:function(e,t,n){e.exports={AddProfile:"AddProfile_AddProfile__1JA_r"}},139:function(e,t,n){e.exports=n(303)},14:function(e,t,n){"use strict";var a=n(91);n.d(t,"g",function(){return c}),n.d(t,"h",function(){return i}),n.d(t,"i",function(){return s}),n.d(t,"k",function(){return o}),n.d(t,"j",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"a",function(){return p}),n.d(t,"b",function(){return h}),n.d(t,"f",function(){return d}),n.d(t,"d",function(){return m}),n.d(t,"e",function(){return v});var r=new a.a,c=function(e){return{type:"SET_SYNC_STEP",syncStep:e}},i=function(e){return function(t){return r.openProfile(e.id).then(function(e){return t({type:"SIGNIN",profile:e})})}},s=function(){return function(e){return r.closeProfile().then(function(){return e({type:"SIGNOUT"})})}},o=function(e,t){return t.id=e,function(e){return r.updateProfile(t).then(function(){return e(i(t))})}},u=function(e){return function(t){return r.addProfile(e).then(function(){return t(l())})}},l=function(){return function(e){return r.getProfiles().then(function(t){return e(function(e){return{type:"RECEIVE_USERS",users:e}}(t))})}},p=function(e){return{type:"ADD_DEVICE",device:e}},h=function(){return function(e){return r.getApps().then(function(t){return e(function(e){return{type:"RECEIVE_APPS",apps:e}}(t))})}},d=function(e){return{type:"SET_CURRENT_APP_REQUEST",app:e}},f=function(e){return{type:"UPDATE_CURRENT_APP_REQUEST",update:e}},m=function(e,t,n){return function(a){return r.handleUserAppLogin(e,t,n).then(function(e){return a(f({isConnected:e}))})}},v=function(e){return function(t){return r.handleUserAppRegister(e).then(function(){return t(f({isConnected:e}))})}}},152:function(e,t){},154:function(e,t){},17:function(e,t,n){"use strict";var a=n(9),r=n(10),c=n(12),i=n(11),s=n(13),o=n(3),u=n(0),l=n.n(u),p=n(4);function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var d=l.a.createElement("g",{fill:"none",fillRule:"evenodd"},l.a.createElement("rect",{height:118,opacity:.5,rx:10,stroke:"#999",strokeWidth:2,width:118,x:1,y:1}),l.a.createElement("path",{d:"m77.2 46.6h-6.5333333l-3.1733334-4.8533333c-.3733333-.3733334-.9333333-.7466667-1.4933333-.7466667h-11.2c-.56 0-1.12.3733333-1.4933333.7466667l-3.1733334 4.8533333h-6.5333333c-3.1733333 0-5.6 2.4266667-5.6 5.6v20.5333333c0 3.1733334 2.4266667 5.6 5.6 5.6h33.6c3.1733333 0 5.6-2.4266666 5.6-5.6v-20.5333333c0-3.1733333-2.4266667-5.6-5.6-5.6zm1.8666667 26.1333333c0 1.12-.7466667 1.8666667-1.8666667 1.8666667h-33.6c-1.12 0-1.8666667-.7466667-1.8666667-1.8666667v-20.5333333c0-1.12.7466667-1.8666667 1.8666667-1.8666667h7.4666667c.56 0 1.12-.3733333 1.4933333-.7466666l3.1733333-4.8533334h9.1466667l3.1733333 4.8533334c.56.3733333 1.12.7466666 1.68.7466666h7.4666667c1.12 0 1.8666667.7466667 1.8666667 1.8666667zm-18.6666667-20.5333333c-5.2266667 0-9.3333333 4.1066667-9.3333333 9.3333333 0 5.2266667 4.1066666 9.3333334 9.3333333 9.3333334s9.3333333-4.1066667 9.3333333-9.3333334c0-5.2266666-4.1066666-9.3333333-9.3333333-9.3333333zm0 14.9333333c-3.1733333 0-5.6-2.4266666-5.6-5.6 0-3.1733333 2.4266667-5.6 5.6-5.6s5.6 2.4266667 5.6 5.6c0 3.1733334-2.4266667 5.6-5.6 5.6z",fill:"#ccc",fillRule:"nonzero"})),f=function(e){return l.a.createElement("svg",h({height:120,viewBox:"0 0 120 120",width:120},e),d)},m=(n.p,n(284),function(e){var t=e.size,n=e.image,a=e.onClick;return l.a.createElement(p.Avatar,{upload:!0,src:n,width:t,height:t,onClick:a})}),v=function(e){var t=e.style,n=e.onClick;return l.a.createElement(f,{className:"Avatar upload",color:"var(--grey-200)",style:t,onClick:n})},b=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(i.a)(t).call(this,e))).openDialog=n.openDialog.bind(Object(o.a)(Object(o.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"openDialog",value:function(){this.refs.fileDialog.click()}},{key:"render",value:function(){var e=this.props,t=e.size,n=e.image,a=e.username,r=e.upload,c=e.onChange,i={backgroundImage:"url("+n+")"};return r?l.a.createElement("div",null,l.a.createElement("input",{name:"avatar",type:"file",ref:"fileDialog",style:{display:"none"},onChange:c,accept:".jpg, .jpeg, .png"}),n?l.a.createElement(m,{size:t,image:n,onClick:this.openDialog}):l.a.createElement(v,{style:i,onClick:this.openDialog})):n?l.a.createElement(p.Avatar,{src:n,width:t,height:t}):l.a.createElement("div",{className:"Avatar initials",style:{backgroundColor:"#458bf8",position:"relative",width:t,height:t}},l.a.createElement("p",null,a[0].toUpperCase()))}}]),t}(l.a.Component);function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}b.defaultProps={size:120};var y=l.a.createElement("defs",null,l.a.createElement("path",{id:"close-svg",d:"M13.7 12.3c.4.4.4 1 0 1.4-.2.2-.4.3-.7.3-.3 0-.5-.1-.7-.3L7 8.4l-5.3 5.3c-.2.2-.4.3-.7.3-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4L5.6 7 .3 1.7C-.1 1.3-.1.7.3.3c.4-.4 1-.4 1.4 0L7 5.6 12.3.3c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4L8.4 7l5.3 5.3z"})),O=l.a.createElement("use",{fill:"currentColor",fillRule:"nonzero",xlinkHref:"#close-svg"}),E=function(e){return l.a.createElement("svg",g({width:14,height:14,viewBox:"0 0 14 14"},e),y,O)};n.p,n(286);function k(e){var t=e.onClose,n=e.width,a=e.height,r=e.children,c={height:a,width:n};return l.a.createElement("div",{className:"Modal"},l.a.createElement("div",{className:"overlay",onClick:t}),l.a.createElement("div",{className:"modal",style:c},t&&l.a.createElement(E,{className:"close",width:9,height:9,onClick:t}),r))}n.d(t,"a",function(){return b}),n.d(t,"b",function(){return k})},177:function(e,t){},202:function(e,t){},24:function(e,t,n){e.exports={Signup:"Signup_Signup__35pSB",title:"Signup_title__2cSqr",user:"Signup_user__cPdbJ",buttons:"Signup_buttons__1ZBD4",TextField:"Signup_TextField__1V6gN"}},25:function(e,t,n){e.exports={header:"Sidebar_header__4dnPH",nav:"Sidebar_nav__2ydLJ",navElement:"Sidebar_navElement__2QNBS",active:"Sidebar_active__2y9in",logout:"Sidebar_logout__1xrQM"}},26:function(e,t,n){e.exports={SyncDevice:"SyncDevice_SyncDevice__2OuS0",title:"SyncDevice_title__15E3r",description:"SyncDevice_description__n8JIp",loader:"SyncDevice_loader__UAgrQ"}},28:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"c",function(){return r}),n.d(t,"b",function(){return c});var a=function(e){return/^[A-z\xc0-\xfa\- ]+$/.test(e)},r=function(e){return/^[\w!?$#@()\-*]+$/.test(e)},c=function(e){return/^(?=.*\d)(?=.*[!?$#@()\-*]).{8,}$/.test(e)}},284:function(e,t,n){},286:function(e,t,n){},298:function(e,t,n){},303:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(131),i=n(30),s=n(132),o=n(16);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var u=n(37),l=n(19),p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{syncStep:0,users:[],apps:[],devices:[],currentUser:null,currentAppRequest:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SIGNIN":return Object(l.a)({},e,{currentUser:t.profile});case"SIGNOUT":return Object(l.a)({},e,{currentUser:null});case"RECEIVE_USERS":return Object(l.a)({},e,{users:t.users});case"RECEIVE_APPS":return Object(l.a)({},e,{apps:t.apps});case"SET_CURRENT_APP_REQUEST":return Object(l.a)({},e,{currentAppRequest:t.app});case"UPDATE_CURRENT_APP_REQUEST":return Object(l.a)({},e,{currentAppRequest:Object(l.a)({},e.currentAppRequest,t.update)});case"ADD_APP":return Object(l.a)({},e,{apps:[].concat(Object(u.a)(e.apps),[t.app])});case"ADD_DEVICE":return Object(l.a)({},e,{devices:[].concat(Object(u.a)(e.devices),[t.device])});case"SET_SYNC_STEP":return Object(l.a)({},e,{syncStep:t.syncStep});default:return e}},h=Object(i.c)({masq:p}),d=n(134),f=(n(298),n(301),window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.d),m=Object(i.e)(h,f(Object(i.a)(s.a)));Object(c.render)(r.a.createElement(o.a,{store:m},r.a.createElement(d.a,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},32:function(e,t,n){"use strict";var a=n(43),r=n(9),c=n(10),i=n(12),s=n(11),o=n(13),u=n(3),l=n(0),p=n.n(l),h=n(4),d=n(17),f=n(28),m=n(24),v=n.n(m),b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this,e))).state={image:"",lastname:"",firstname:"",username:"",password:"",passwordConfirmation:""},n.currentStep=0,n.validationEnabled=!1,n.refAvatar=p.a.createRef(),n.next=n.next.bind(Object(u.a)(Object(u.a)(n))),n.finish=n.finish.bind(Object(u.a)(Object(u.a)(n))),n.isValid=n.isValid.bind(Object(u.a)(Object(u.a)(n))),n.previous=n.previous.bind(Object(u.a)(Object(u.a)(n))),n.openDialog=n.openDialog.bind(Object(u.a)(Object(u.a)(n))),n.handleKeyUp=n.handleKeyUp.bind(Object(u.a)(Object(u.a)(n))),n}return Object(o.a)(t,e),Object(c.a)(t,[{key:"isValid",value:function(e){var t=this.state[e];if(!this.validationEnabled)return!0;switch(e){case"image":return!0;case"firstname":case"lastname":return Object(f.a)(t);case"username":return Object(f.c)(t);case"password":return Object(f.b)(t);case"passwordConfirmation":return t===this.state.password;default:return!1}}},{key:"onChange",value:function(e,t){var n=t.target.value.trim();this.setState(Object(a.a)({},e,n))}},{key:"onImageChange",value:function(e){var t=this,n=new window.FileReader,a=e.target.files[0];a&&(n.addEventListener("load",function(){t.setState({image:n.result})}),n.readAsDataURL(a))}},{key:"openDialog",value:function(){this.refAvatar.current.openDialog()}},{key:"next",value:function(){var e=this;if(this.validationEnabled=!0,!["lastname","firstname","username"].every(function(t){return e.isValid(t)}))return this.forceUpdate();this.validationEnabled=!1,this.currentStep++,this.forceUpdate()}},{key:"previous",value:function(){this.currentStep--,this.forceUpdate()}},{key:"finish",value:function(){var e=this.props.onSignup;if(this.validationEnabled=!0,!this.isValid("password")||!this.isValid("passwordConfirmation"))return this.forceUpdate();e(this.state)}},{key:"handleKeyUp",value:function(e){"Enter"===e.key&&(0===this.currentStep?this.next():this.finish())}},{key:"render",value:function(){var e=this;return p.a.createElement(d.b,{onClose:this.props.onClose,height:650,width:511},p.a.createElement("div",{className:v.a.Signup},p.a.createElement("span",{className:v.a.title},"Ajouter un nouvel utilisateur"),0===this.currentStep&&p.a.createElement(p.a.Fragment,null,p.a.createElement(d.a,{size:120,upload:!0,ref:this.refAvatar,onChange:function(t){return e.onImageChange(t)},image:this.state.image||null}),p.a.createElement("div",{style:{paddingTop:24}}),p.a.createElement(h.Button,{secondary:!0,label:"Importer une photo",onClick:this.openDialog}),p.a.createElement("div",{style:{paddingBottom:32}}),p.a.createElement(h.TextField,{className:v.a.TextField,defaultValue:this.state.lastname,label:this.isValid("lastname")?"Nom":"Le nom ne peut \xeatre vide, et ne peut contenir que des caract\xe8res alphanum\xe9riques et des espaces.",error:!this.isValid("lastname"),onChange:function(t){return e.onChange("lastname",t)}}),p.a.createElement(h.TextField,{className:v.a.TextField,defaultValue:this.state.firstname,label:this.isValid("firstname")?"Pr\xe9nom":"Le pr\xe9nom ne peut \xeatre vide, et ne peut contenir que des caract\xe8res alphanum\xe9riques et des espaces.",error:!this.isValid("firstname"),onChange:function(t){return e.onChange("firstname",t)}}),p.a.createElement(h.TextField,{className:v.a.TextField,defaultValue:this.state.username,error:!this.isValid("username"),onChange:function(t){return e.onChange("username",t)},onKeyUp:this.handleKeyUp,label:this.isValid("username")?"Pseudo (affich\xe9)":"Le pseudo ne doit pas contenir d'espaces, et peut contenir les caract\xe8res sp\xe9ciaux suivants: !?$#@()-*"}),p.a.createElement("div",{className:v.a.buttons},p.a.createElement(h.Button,{label:"Suivant",onClick:this.next,width:185}))),1===this.currentStep&&p.a.createElement(p.a.Fragment,null,p.a.createElement(d.a,{size:120,image:this.state.image,username:this.state.username,firstname:this.state.firstname,lastname:this.state.lastname}),p.a.createElement("p",{className:v.a.user},this.state.username),p.a.createElement(h.TextField,{className:v.a.TextField,autoFocus:!0,type:"password",label:this.isValid("password")?"Mot de passe":"Le mot de passe doit \xeatre compos\xe9 d'au moins 8 caract\xe8res, et contenir au moins un chiffre et un caract\xe8re sp\xe9cial (!?$#@()-*)",error:!this.isValid("password"),onChange:function(t){return e.onChange("password",t)}}),p.a.createElement(h.TextField,{className:v.a.TextField,type:"password",label:this.isValid("passwordConfirmation")?"Mot de passe (confirmation)":"Les mots de passe ne correspondent pas.",error:!this.isValid("passwordConfirmation"),onKeyUp:this.handleKeyUp,onChange:function(t){return e.onChange("passwordConfirmation",t)}}),p.a.createElement("div",{className:v.a.buttons},p.a.createElement(h.Button,{label:"Pr\xe9c\xe9dent",onClick:this.previous,width:185}),p.a.createElement(h.Button,{label:"Terminer",onClick:this.finish,width:185})))))}}]),t}(p.a.Component),g=n(2),y=n.n(g),O=n(6),E=n(16),k=n(14),j=n(38),w=n.n(j),_=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this,e))).state={loading:!0},n.handleOk=n.handleOk.bind(Object(u.a)(Object(u.a)(n))),n.handleRefuse=n.handleRefuse.bind(Object(u.a)(Object(u.a)(n))),n.handleAccept=n.handleAccept.bind(Object(u.a)(Object(u.a)(n))),n}return Object(o.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(O.a)(y.a.mark(function e(){var t,n,a,r;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.appRequest,n=t.channel,a=t.key,r=t.appId,e.next=3,this.props.handleUserAppLogin(n,a,r);case 3:this.setState({loading:!1});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleRefuse",value:function(){var e=Object(O.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.handleUserAppRegister(!1);case 2:return e.next=4,this.props.setCurrentAppRequest(null);case 4:this.props.onClose();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleAccept",value:function(){var e=Object(O.a)(y.a.mark(function e(){var t=this;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({loading:!0},Object(O.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.handleUserAppRegister(!0);case 2:return t.setState({loading:!1}),e.next=5,t.props.fetchApps();case 5:case"end":return e.stop()}},e,this)})));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleOk",value:function(){var e=Object(O.a)(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.setCurrentAppRequest(null);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"renderButtons",value:function(){var e=this.state.loading,t=this.props.appRequest;return e?p.a.createElement(h.Loader,null):!1===t.isConnected?p.a.createElement(l.Fragment,null,p.a.createElement(h.Button,{label:"Refuser",onClick:this.handleRefuse,color:"#e53b5b"}),p.a.createElement(h.Button,{label:"Valider",onClick:this.handleAccept,color:"#40ae6c"})):t.isConnected?p.a.createElement(h.Button,{label:"OK",onClick:this.handleOk,color:"#40ae6c"}):void 0}},{key:"render",value:function(){var e=this.props,t=e.appRequest,n=e.onClose;return p.a.createElement(d.b,{width:511,height:400,onClose:n},p.a.createElement("div",{className:w.a.AuthApp},p.a.createElement("p",{className:w.a.title},"Nouvelle requ\xeate de connexion de:"),p.a.createElement("p",{className:w.a.appTitle},t.appId),p.a.createElement("p",{className:w.a.description},"Cette notification apparait car cette application demande un acc\xe8s \xe0 votre stockage Masq."),p.a.createElement("p",{className:w.a.description},"Si vous n\u2019\xeates pas \xe0 l\u2019origine de cette demande, veuillez refuser cette requ\xeate."),p.a.createElement("div",{className:w.a.buttons},this.renderButtons())))}}]),t}(p.a.Component),C=Object(E.b)(function(e){return{currentUser:e.masq.currentUser}},function(e){return{handleUserAppLogin:function(t,n,a){return e(Object(k.d)(t,n,a))},handleUserAppRegister:function(t){return e(Object(k.e)(t))},setCurrentAppRequest:function(t){return e(Object(k.f)(t))},fetchApps:function(){return e(Object(k.b)())}}})(_);function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var x=p.a.createElement("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),A=p.a.createElement("polyline",{points:"22 4 12 14.01 9 11.01"}),N=function(e){return p.a.createElement("svg",S({width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-check-circle"},e),x,A)},P=(n.p,n(26)),D=n.n(P),R=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this,e))).handleOnClose=n.handleOnClose.bind(Object(u.a)(Object(u.a)(n))),n}return Object(o.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=setInterval(function(){e.props.setSyncStep(e.props.syncStep+1),2===e.props.syncStep&&clearInterval(t)},3e3)}},{key:"copyLink",value:function(){document.querySelector("input").select(),document.execCommand("copy")}},{key:"handleOnClose",value:function(){this.props.setSyncStep(0),this.props.onClose()}},{key:"renderSyncLink",value:function(){return p.a.createElement(d.b,{height:370,width:511,onClose:this.handleOnClose},p.a.createElement("div",{className:D.a.SyncDevice},p.a.createElement("p",{className:D.a.title},"Ajouter un appareil"),p.a.createElement("p",{className:D.a.description},"Copiez-collez le lien suivant pour synchroniser votre profil et vos applications avec un autre appareil."),p.a.createElement("input",{id:"link",readOnly:!0,defaultValue:"qwa.nt/0BJ8ZX"}),p.a.createElement(h.Button,{label:"Copier",onClick:this.copyLink})))}},{key:"renderSyncLoading",value:function(){return p.a.createElement(d.b,{height:370,width:511,onClose:this.handleOnClose},p.a.createElement("div",{className:D.a.SyncDevice},p.a.createElement("p",{className:D.a.title},"Ajouter un appareil"),p.a.createElement("p",{className:D.a.description},"Synchronisation en cours, veuillez patienter..."),p.a.createElement("div",{className:D.a.loader},p.a.createElement(h.Loader,null))))}},{key:"renderSyncComplete",value:function(){return p.a.createElement(d.b,{height:370,width:511,onClose:this.handleOnClose},p.a.createElement("div",{className:D.a.SyncDevice},p.a.createElement(N,{width:160,height:160,color:"#40ae6c"}),p.a.createElement("p",{className:D.a.description},"Synchronisation termin\xe9e. Vous pouvez maintenant vous connecter"),p.a.createElement(h.Button,{label:"OK",onClick:this.handleOnClose})))}},{key:"render",value:function(){var e=this.props.syncStep;return p.a.createElement("div",null,0===e&&this.renderSyncLink(),1===e&&this.renderSyncLoading(),2===e&&this.renderSyncComplete())}}]),t}(p.a.Component),U=Object(E.b)(function(e){return{syncStep:e.masq.syncStep}},function(e){return{setSyncStep:function(t){return e(Object(k.g)(t))}}})(R),z=n(137),B=n.n(z),q=function(e){var t=e.onClose,n=e.onNewProfile,a=e.onSyncProfile;return p.a.createElement(d.b,{height:370,width:511,onClose:t},p.a.createElement("div",{className:B.a.AddProfile},p.a.createElement(h.Button,{label:"Nouveau profil",onClick:n}),p.a.createElement(h.Button,{label:"Synchroniser un profil existant",onClick:a})))};n.d(t,"c",function(){return b}),n.d(t,"b",function(){return C}),n.d(t,"d",function(){return U}),n.d(t,"a",function(){return q})},33:function(e,t,n){e.exports={Login:"Login_Login__Qynu5",title:"Login_title__1BzJq",Logo:"Login_Logo__1IASN",users:"Login_users__1e0_A",PlusSquare:"Login_PlusSquare__18XVq",user:"Login_user__1JIOl",Background:"Login_Background__2i8U8"}},34:function(e,t,n){"use strict";var a=n(9),r=n(10),c=n(12),i=n(11),s=n(13),o=n(3),u=n(0),l=n.n(u),p=n(16),h=n(14),d=n(304),f=n(33),m=n.n(f);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var b=l.a.createElement("g",{fill:"#FFF",fillRule:"nonzero"},l.a.createElement("g",{fillOpacity:.5},l.a.createElement("path",{d:"M78.899 29.426l-.056-.487c0-.046-.045-.08-.09-.08h-.023c-.01 0-.01.012-.022.012a1.103 1.103 0 0 1-.393.068c-.158 0-.27-.046-.338-.125-.067-.09-.1-.227-.1-.43v-1.066h.808a.077.077 0 0 0 .079-.08v-.476c0-.045-.045-.08-.09-.08h-.809V25.993c0-.046-.045-.08-.09-.08h-.607c-.045 0-.078.034-.09.08v.69h-.472a.089.089 0 0 0-.09.092v.476c0 .045.034.079.068.09h.483v1.202c0 .374.09.657.259.839.168.181.438.272.786.272.146 0 .292-.012.427-.046.101-.022.203-.056.27-.09.067-.023.09-.046.09-.091 0 .011 0 .011 0 0zM65.155 28.769c-.01-.023-.022-.046-.033-.068-.012-.057.033-.114.067-.16.034-.045.056-.101.09-.158.056-.102.101-.215.135-.329.078-.238.1-.487.1-.736a2.605 2.605 0 0 0-.145-.782 1.98 1.98 0 0 0-.382-.624 2.048 2.048 0 0 0-.506-.43 1.98 1.98 0 0 0-.663-.261c-.247-.057-.506-.068-.753-.057-.258.023-.506.08-.742.193-.236.102-.449.249-.629.43a2.44 2.44 0 0 0-.45.624c-.112.238-.18.487-.202.748-.022.26-.01.521.045.77.057.25.158.488.293.704.134.215.303.396.494.544.191.147.416.26.64.34.124.045.259.068.394.09.123.023.247.034.37.023.124 0 .237-.011.36-.034.068-.011.135-.023.191-.034.056-.011.113-.023.135-.08.023-.045-.011-.09-.034-.135-.022-.057-.056-.102-.078-.16-.045-.101-.101-.192-.146-.294a.115.115 0 0 0-.068-.056c-.022-.012-.056 0-.078 0-.034.01-.068.01-.102.01-.134.024-.27.024-.404 0a1.466 1.466 0 0 1-.697-.294 1.557 1.557 0 0 1-.46-.59 1.563 1.563 0 0 1-.113-.747c.034-.25.124-.5.27-.703a1.5 1.5 0 0 1 .562-.465 1.441 1.441 0 0 1 1.404.09c.18.114.326.273.45.454a1.528 1.528 0 0 1 .112 1.383 1.57 1.57 0 0 1-.37.521c-.023.023-.046.035-.057.069a.098.098 0 0 0 0 .079l.416.839c.022.045.045.102.09.136.034.022.067.011.101.011h.64c.08 0 .135-.08.09-.159-.044-.079-.078-.158-.123-.226l-.214-.476zM68.931 28.644l.506-1.916a.085.085 0 0 1 .079-.056h.618c.045 0 .09.034.09.09v.023l-.9 2.709c-.01.034-.044.045-.078.045h-.585a.085.085 0 0 1-.078-.056l-.63-1.848-.606 1.848a.094.094 0 0 1-.079.045h-.573a.085.085 0 0 1-.079-.057l-.899-2.731c0-.046.034-.091.09-.091h.64c.034 0 .057.023.068.045l.506 1.927.584-1.915a.085.085 0 0 1 .079-.057h.528c.034 0 .067.023.079.045l.64 1.95zM72.471 27.034a.93.93 0 0 0-.382-.34 1.17 1.17 0 0 0-.528-.124c-.259 0-.495.068-.708.215-.214.136-.371.329-.483.555a1.724 1.724 0 0 0-.169.771v.057c.011.272.067.521.169.737.112.226.27.408.472.532.202.125.427.182.674.182.18 0 .337-.023.472-.08 0 0 .303-.102.472-.374l.011.295c.011.045.045.08.09.08h.573c.045 0 .09-.035.09-.091V26.75a.089.089 0 0 0-.09-.09h-.573a.098.098 0 0 0-.09.067v.306zm-.169.499c.135.147.191.34.191.578 0 .25-.067.442-.213.6a.694.694 0 0 1-.54.228.7.7 0 0 1-.539-.227.844.844 0 0 1-.213-.533s-.045-.374.213-.657c.135-.159.326-.227.55-.227-.01-.023.327-.045.551.238zM74.483 26.74c-.012-.046-.045-.08-.09-.08h-.585a.089.089 0 0 0-.09.09v2.699c0 .045.034.09.09.09h.607a.085.085 0 0 0 .079-.056v-1.485c0-.227.056-.408.157-.533a.535.535 0 0 1 .438-.193c.337 0 .506.227.506.67v1.54a.085.085 0 0 0 .079.057h.607c.044 0 .09-.034.09-.09v-1.655c0-.397-.09-.703-.27-.907-.18-.204-.439-.317-.776-.317-.202 0-.37.034-.517.113a.973.973 0 0 0-.348.329l.023-.272z"})),l.a.createElement("path",{d:"M21.497 8.887C20.587 7.833 19.25 7.3 17.52 7.3c-1.011 0-1.944.238-2.787.725-.854.476-1.472 1.122-1.876 1.905-.854-1.757-2.349-2.63-4.462-2.63-1.01 0-1.899.193-2.652.578a4.317 4.317 0 0 0-1.786 1.7l-.023-1.235a.574.574 0 0 0-.55-.578H.663a.578.578 0 0 0-.573.578v13.534c0 .317.258.578.573.578h2.82c.315 0 .574-.26.574-.578v-7.368c0-1.134.258-2.029.753-2.686.505-.658 1.202-.987 2.101-.987.9 0 1.55.284 1.955.84.405.555.618 1.427.618 2.595v7.594c0 .318.259.579.574.579h2.831c.315 0 .562-.25.574-.556v-7.356c0-1.157.247-2.063.753-2.71.505-.657 1.202-.986 2.078-.986.877 0 1.529.284 1.945.84.415.555.629 1.427.629 2.595v7.628c.022.307.27.545.573.545h2.832c.314 0 .573-.261.573-.579v-8.342c.022-2.03-.438-3.582-1.349-4.636zM39.938 7.753H37.23a.566.566 0 0 0-.55.578l-.046 1.327a4.816 4.816 0 0 0-1.932-1.746c-.81-.42-1.72-.624-2.709-.624-1.337 0-2.54.363-3.607 1.077a7.22 7.22 0 0 0-2.472 2.857c-.585 1.19-.877 2.493-.877 3.91 0 1.542.292 2.902.888 4.081.596 1.179 1.393 2.097 2.416 2.732 1.023.635 2.169.952 3.45.952 1.09 0 2.045-.193 2.866-.59a4.769 4.769 0 0 0 1.977-1.745l.045 1.292c0 .317.259.578.573.578h2.675c.315 0 .573-.26.573-.578V8.331a.583.583 0 0 0-.562-.578zm-4.281 10.395c-.73.793-1.652 1.19-2.776 1.19-1.124 0-2.056-.397-2.776-1.19-.73-.794-1.09-1.814-1.09-3.061 0-1.235.36-2.244 1.068-3.038.72-.793 1.64-1.179 2.787-1.179 1.146 0 2.079.397 2.787 1.18.719.793 1.067 1.802 1.067 3.037.023 1.258-.337 2.278-1.067 3.06zM48.153 22.92a12.28 12.28 0 0 1-3.147-.386c-.797-.204-1.45-.476-1.955-.782a.633.633 0 0 1-.28-.623l.291-1.95a.63.63 0 0 1 .91-.465c.461.238.956.442 1.506.612a8.379 8.379 0 0 0 2.506.408c1.619 0 2.439-.419 2.439-1.246 0-.442-.169-.783-.517-1.01-.348-.226-1.056-.498-2.146-.804-1.72-.476-2.945-1.088-3.675-1.836-.73-.737-1.101-1.735-1.101-2.993 0-1.405.528-2.516 1.573-3.321 1.045-.805 2.495-1.213 4.326-1.213.9 0 1.798.102 2.686.318.697.17 1.304.374 1.798.612a.617.617 0 0 1 .337.657l-.27 1.87a.623.623 0 0 1-.865.488 8.393 8.393 0 0 0-1.303-.442 8.726 8.726 0 0 0-2.214-.306c-1.394 0-2.09.374-2.09 1.122 0 .42.168.76.505.997.338.238 1 .51 1.99.794 1.831.544 3.124 1.179 3.876 1.904.753.737 1.135 1.746 1.135 3.027 0 1.428-.561 2.539-1.674 3.355-1.135.805-2.675 1.213-4.641 1.213zM56.289 27.828a.826.826 0 0 1 .652-.318c.157 0 .292.034.438.114.18.102.326.25.404.43.068.16.113.318.113.5 0 .34-.113.6-.326.804a.895.895 0 0 1-.64.25.775.775 0 0 1-.641-.318v.102a.328.328 0 0 1-.023.136c-.022.023-.056.023-.134.023h-.236c-.068 0-.113-.012-.124-.023-.022-.023-.022-.057-.022-.136v-3.095c0-.068.01-.113.022-.136.022-.022.056-.022.124-.022h.236a.32.32 0 0 1 .134.022c.023.023.023.057.023.136v1.53zm.483.181a.533.533 0 0 0-.382.159.516.516 0 0 0-.157.385.542.542 0 0 0 .54.544c.145 0 .28-.056.381-.158a.524.524 0 0 0 .158-.397.562.562 0 0 0-.158-.386.506.506 0 0 0-.382-.147zM58.862 29.245l-.809-1.474a.562.562 0 0 1-.045-.102c0-.034.011-.057.034-.068a.298.298 0 0 1 .124-.023h.292c.056 0 .1 0 .112.012a.423.423 0 0 1 .068.09l.528 1.02.505-1.008c.023-.057.045-.091.057-.091.01-.011.056-.011.112-.011h.28c.057 0 .09 0 .113.011.034.011.045.045.045.08 0 .022-.011.056-.045.101l-1.416 2.732c-.022.057-.045.08-.067.09-.011.012-.056.012-.112.012h-.281c-.057 0-.09 0-.113-.011-.033-.012-.045-.046-.045-.08 0-.022.012-.056.045-.102l.618-1.178z"}),l.a.createElement("path",{fillOpacity:.5,d:"M76.944 18.533c-.057-.113-.135-.227-.158-.351-.056-.295.191-.556.337-.794a11.732 11.732 0 0 0 1.135-2.494 11.92 11.92 0 0 0 .517-3.774c-.033-1.372-.28-2.743-.775-4.013A11.333 11.333 0 0 0 76.067 3.9a10.682 10.682 0 0 0-2.618-2.21 11.403 11.403 0 0 0-3.383-1.36A13.01 13.01 0 0 0 66.2.068c-1.314.102-2.618.42-3.82.963a11.504 11.504 0 0 0-3.237 2.21 11.196 11.196 0 0 0-2.292 3.209 11.64 11.64 0 0 0-1.057 3.831 12.794 12.794 0 0 0 .236 3.979c.281 1.27.787 2.493 1.484 3.593a10.734 10.734 0 0 0 2.55 2.788c.99.76 2.113 1.338 3.293 1.723.652.216 1.315.363 1.99.465.629.09 1.292.147 1.932.125a17.049 17.049 0 0 0 1.854-.16c.338-.056.675-.112 1-.203.282-.068.585-.125.697-.43.09-.25-.033-.454-.146-.67l-.404-.816-.742-1.496a.559.559 0 0 0-.326-.295c-.146-.045-.27-.011-.416.023a6.394 6.394 0 0 1-.494.09 7.722 7.722 0 0 1-2.045.012 7.49 7.49 0 0 1-3.551-1.485 7.525 7.525 0 0 1-2.338-3.026 7.554 7.554 0 0 1-.55-3.854 7.473 7.473 0 0 1 1.393-3.57 7.441 7.441 0 0 1 2.854-2.37 7.41 7.41 0 0 1 3.855-.691 7.407 7.407 0 0 1 3.36 1.156 7.647 7.647 0 0 1 2.281 2.3 7.725 7.725 0 0 1 1.169 3.64 7.514 7.514 0 0 1-.596 3.4 7.55 7.55 0 0 1-1.921 2.675c-.113.102-.236.193-.281.351a.54.54 0 0 0 .022.397l2.146 4.274c.113.215.214.544.439.68.157.09.36.068.528.068h3.281c.394-.012.674-.431.483-.794-.202-.397-.415-.793-.618-1.179l-1.27-2.448z"})),g=function(e){return l.a.createElement("svg",v({width:79,height:31,viewBox:"0 0 79 31"},e),b)};n.p;function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var O=l.a.createElement("path",{d:"M10.2 41.8c2 3.5 4.2 6.9 6.6 10.1H0v-3.5c3.3-2.3 6.7-4.5 10.2-6.6zM206.1 40.5c-4.6 3.4-8.8 7.2-12.6 11.4h-22.3c5.1-6.9 9.3-14.5 12.5-22.6 7.7 3.3 15.2 7 22.4 11.2z",fill:"#3394D2"}),E=l.a.createElement("path",{d:"M183.7 29.3c-3.2 8.1-7.4 15.7-12.5 22.6H16.7c-2.4-3.2-4.6-6.6-6.6-10.1C36.5 26 66.8 16.3 99.4 14.6a163.613 163.613 0 0 1 19.8 0c22.7 1.2 44.5 6.3 64.5 14.7z",fill:"#4ebbc2"}),k=l.a.createElement("path",{d:"M206.1 40.5c13-9.6 28.8-15.6 45.9-16.4v27.8h-28.6c-.3-.3-.7-.5-1-.8-.3-.2-.6-.5-.9-.7-.1 0-.1-.1-.2-.1-.3-.2-.6-.5-1-.7l-.9-.6c-.1-.1-.2-.2-.3-.2-.2-.2-.5-.3-.7-.5l-.9-.6c-.2-.1-.4-.3-.6-.4-.2-.2-.5-.3-.7-.5l-.9-.6-.9-.6s-.1-.1-.2-.1c-.4-.2-.7-.5-1.1-.7-.4-.2-.8-.5-1.1-.7s-.8-.5-1.2-.7c-.3-.2-.5-.3-.8-.5-1.4-.9-2.6-1.6-3.9-2.4z",fill:"#e53b5b"}),j=l.a.createElement("path",{d:"M223.4 51.9h-29.9c3.8-4.2 8-8 12.6-11.4 1.3.8 2.6 1.5 3.8 2.3.3.2.5.3.8.5.4.2.8.5 1.2.7s.8.5 1.1.7c.4.2.7.5 1.1.7.1 0 .1.1.2.1l.9.6.9.6c.3.2.5.3.7.5.2.1.4.3.6.4l.9.6c.2.2.5.3.7.5.1.1.2.2.3.2l.9.6c.3.2.7.5 1 .7.1 0 .1.1.2.1.3.2.6.5.9.7.4.4.7.6 1.1.9z",fill:"#6f559f"}),w=function(e){return l.a.createElement("svg",y({id:"Calque_1",preserveAspectRatio:"none",viewBox:"0 0 252 52"},e),O,E,k,j)};n.p;function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var C=l.a.createElement("defs",null,l.a.createElement("rect",{id:"a",width:120,height:120,rx:10}),l.a.createElement("path",{id:"b",d:"M78.667 60c0 1.4-.934 2.333-2.334 2.333h-14v14c0 1.4-.933 2.334-2.333 2.334-1.4 0-2.333-.934-2.333-2.334v-14h-14c-1.4 0-2.334-.933-2.334-2.333 0-1.4.934-2.333 2.334-2.333h14v-14c0-1.4.933-2.334 2.333-2.334 1.4 0 2.333.934 2.333 2.334v14h14c1.4 0 2.334.933 2.334 2.333z"})),S=l.a.createElement("g",{fill:"none",fillRule:"evenodd"},l.a.createElement("g",{opacity:.5},l.a.createElement("use",{fill:"#1F2330",xlinkHref:"#a"}),l.a.createElement("rect",{width:118,height:118,x:1,y:1,stroke:"#FFF",strokeWidth:2,rx:10})),l.a.createElement("use",{fill:"#FFF",fillRule:"nonzero",opacity:.5,xlinkHref:"#b"})),x=function(e){return l.a.createElement("svg",_({xmlnsXlink:"http://www.w3.org/1999/xlink",width:120,height:120,viewBox:"0 0 120 120"},e),C,S)},A=(n.p,n(17)),N=n(32),P=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(i.a)(t).call(this,e))).state={isModalOpened:!1,isLoggedIn:!1,signup:!1,sync:!1},n.handleSignup=n.handleSignup.bind(Object(o.a)(Object(o.a)(n))),n.handleClickNewUser=n.handleClickNewUser.bind(Object(o.a)(Object(o.a)(n))),n.handleClickSyncProfile=n.handleClickSyncProfile.bind(Object(o.a)(Object(o.a)(n))),n.handleClickNewProfile=n.handleClickNewProfile.bind(Object(o.a)(Object(o.a)(n))),n.handleClose=n.handleClose.bind(Object(o.a)(Object(o.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchUsers()}},{key:"handleClickNewUser",value:function(){this.setState({isModalOpened:!this.state.isModalOpened})}},{key:"handleClose",value:function(){this.setState({isModalOpened:!1,signup:!1,sync:!1})}},{key:"handleSignIn",value:function(e){this.props.signin(e),this.setState({isLoggedIn:!0})}},{key:"handleSignup",value:function(e){(0,this.props.signup)(e),this.setState({isModalOpened:!1,signup:!1})}},{key:"handleClickNewProfile",value:function(){this.setState({isModalOpened:!1,signup:!0})}},{key:"handleClickSyncProfile",value:function(){this.setState({isModalOpened:!1,sync:!0})}},{key:"render",value:function(){var e=this,t=this.props,n=t.users,a=t.user,r=this.state,c=r.isModalOpened,i=r.signup,s=r.sync;return a?l.a.createElement(d.a,{to:"/apps"}):l.a.createElement("div",{className:m.a.Login},l.a.createElement(g,{className:m.a.Logo}),l.a.createElement("h1",{className:m.a.title},"Qui est-ce ?"),l.a.createElement("div",{className:m.a.users},n.map(function(t){return l.a.createElement("div",{key:t.username,className:m.a.user,onClick:function(){return e.handleSignIn(t)}},l.a.createElement(A.a,t),l.a.createElement("h2",null,t.username))}),l.a.createElement(x,{className:m.a.PlusSquare,onClick:this.handleClickNewUser})),l.a.createElement(w,{className:m.a.Background}),i&&l.a.createElement(N.c,{onSignup:this.handleSignup,onClose:this.handleClose}),s&&l.a.createElement(N.d,{onClose:this.handleClose}),c&&l.a.createElement(N.a,{onClose:this.handleClose,onNewProfile:this.handleClickNewProfile,onSyncProfile:this.handleClickSyncProfile}))}}]),t}(u.Component),D=Object(p.b)(function(e){return{user:e.masq.currentUser,users:e.masq.users}},function(e){return{signin:function(t){return e(Object(h.h)(t))},signup:function(t){return e(Object(h.j)(t))},fetchUsers:function(t){return e(Object(h.c)(t))}}})(P),R=n(4),U=n(87),z=n.n(U),B=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.props.user&&this.props.fetchApps()}},{key:"render",value:function(){var e=this.props,t=e.apps;return e.user?!!t&&l.a.createElement("div",{className:z.a.Apps},l.a.createElement("p",{className:"title"},"Mes Applications"),l.a.createElement("p",{className:"subtitle"},"Retrouvez vos applications synchronis\xe9es avec Masq"),t.map(function(e,t){return l.a.createElement("div",{key:t,className:z.a.Card},l.a.createElement(R.Card,{minHeight:64,title:e.name,image:e.image,color:"#a3005c",description:e.description}))})):l.a.createElement(d.a,{to:"/"})}}]),t}(u.PureComponent),q=Object(p.b)(function(e){return{user:e.masq.currentUser,apps:e.masq.apps}},function(e){return{fetchApps:function(){return e(Object(h.b)())}}})(B),I=n(306),M=n(25),L=n.n(M);function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var T=l.a.createElement("path",{d:"m37.2 0h-6.3c-.54 0-.9.36-.9.9v6.3c0 .54.36.9.9.9h6.3c.54 0 .9-.36.9-.9v-6.3c0-.54-.36-.9-.9-.9zm-.9 6.3h-4.5v-4.5h4.5zm10.8-6.3h-6.3c-.54 0-.9.36-.9.9v6.3c0 .54.36.9.9.9h6.3c.54 0 .9-.36.9-.9v-6.3c0-.54-.36-.9-.9-.9zm-.9 6.3h-4.5v-4.5h4.5zm.9 3.6h-6.3c-.54 0-.9.36-.9.9v6.3c0 .54.36.9.9.9h6.3c.54 0 .9-.36.9-.9v-6.3c0-.54-.36-.9-.9-.9zm-.9 6.3h-4.5v-4.5h4.5zm-9-6.3h-6.3c-.54 0-.9.36-.9.9v6.3c0 .54.36.9.9.9h6.3c.54 0 .9-.36.9-.9v-6.3c0-.54-.36-.9-.9-.9zm-.9 6.3h-4.5v-4.5h4.5z",transform:"translate(-30)"}),F=function(e){return l.a.createElement("svg",V({height:18,viewBox:"0 0 18 18",width:18},e),T)};n.p;function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var K=l.a.createElement("path",{d:"m13 0h-10c-1.7 0-3 1.3-3 3v16c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-16c0-1.7-1.3-3-3-3zm1 19c0 .6-.4 1-1 1h-10c-.6 0-1-.4-1-1v-16c0-.6.4-1 1-1h10c.6 0 1 .4 1 1zm-6-1c1.1045695 0 2-.8954305 2-2s-.8954305-2-2-2-2 .8954305-2 2 .8954305 2 2 2z",transform:""}),H=function(e){return l.a.createElement("svg",J({height:22,viewBox:"0 0 16 22",width:16},e),K)};n.p;function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var $=l.a.createElement("path",{d:"m12 8c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm8.3 1.4c.1-.2.3-.4.7-.4 1.7 0 3-1.3 3-3s-1.3-3-3-3h-.2c-.2 0-.4-.1-.5-.3 0-.1 0-.1-.1-.2-.1-.2-.1-.5.2-.8 1.2-1.2 1.2-3.1 0-4.2-.6-.6-1.3-.9-2.1-.9s-1.6.3-2.2.9c-.2.2-.5.2-.7.1-.2 0-.4-.3-.4-.6 0-1.7-1.3-3-3-3s-3 1.3-3 3v.2c0 .2-.1.4-.3.5-.1 0-.1 0-.2.1-.2.1-.5 0-.8-.2-1.2-1.2-3.1-1.2-4.2 0-1.2 1.2-1.2 3.1.1 4.3.2.2.2.5.1.8-.1.2-.4.4-.7.4-1.7 0-3 1.3-3 3s1.3 3 3 3h.2c.3 0 .5.2.6.4s.1.5-.2.8c-.6.6-.9 1.3-.9 2.1s.3 1.5.9 2.1c1.2 1.2 3.1 1.2 4.3-.1.2-.2.5-.2.8-.1s.4.3.4.7c0 1.7 1.3 3 3 3s3-1.3 3-3v-.2c0-.3.2-.5.4-.6s.5-.1.8.2c1.2 1.2 3.1 1.2 4.2 0 1.2-1.2 1.2-3.1-.1-4.3-.1-.2-.2-.5-.1-.7zm-1.8-.8c-.4 1-.2 2.1.6 3 .2.2.3.4.3.7s-.1.5-.3.7-.4.3-.7.3c-.3 0-.5-.1-.8-.4-.8-.8-1.9-1-2.9-.5-1 .4-1.6 1.4-1.6 2.4v.2c0 .6-.4 1-1 1s-1-.4-1-1v-.1c0-1.1-.7-2-1.7-2.4-.3-.2-.7-.2-1.1-.2-.7 0-1.4.3-1.9.8-.4.4-1 .4-1.4 0-.2-.2-.3-.4-.3-.7s.1-.5.4-.8c.8-.8 1-1.9.5-2.9-.4-1-1.4-1.6-2.4-1.6h-.2c-.6 0-1-.4-1-1s.4-1 1-1h.1c1.1 0 2-.7 2.4-1.7s.2-2.1-.6-3c-.4-.4-.4-1 0-1.4s1-.4 1.5.1c.7.7 1.8.9 2.7.6.1 0 .2 0 .3-.1 1-.4 1.6-1.4 1.6-2.4v-.2c0-.6.4-1 1-1s1 .4 1 1.1c0 1.1.6 2 1.6 2.4s2.1.2 3-.6c.2-.2.4-.3.7-.3s.5.1.7.3c.4.4.4 1-.1 1.5-.7.7-.9 1.8-.6 2.7 0 .1 0 .2.1.3.4 1 1.4 1.6 2.4 1.6h.2c.6 0 1 .4 1 1s-.4 1-1.1 1c-1 0-2 .6-2.4 1.6z",transform:""}),W=function(e){return l.a.createElement("svg",Q({height:24,viewBox:"0 0 24 24",width:24},e),$)};n.p;function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var X=l.a.createElement("path",{d:"m9.01126408 21c0 .6-.40050063 1-1.00125156 1h-5.00625783c-1.70212766 0-3.00375469-1.3-3.00375469-3v-16c0-1.7 1.30162703-3 3.00375469-3h5.00625783c.60075093 0 1.00125156.4 1.00125156 1s-.40050063 1-1.00125156 1h-5.00625783c-.60075094 0-1.00125156.4-1.00125156 1v16c0 .6.40050062 1 1.00125156 1h5.00625783c.60075093 0 1.00125156.4 1.00125156 1zm10.91364202-9.6c.1001252-.2.1001252-.5 0-.8-.1001251-.1-.1001251-.2-.2002503-.3l-4.0050062-4c-.4005007-.4-1.0012516-.4-1.4017522 0-.4005007.4-.4005007 1 0 1.4l2.3028786 2.3h-9.61201505c-.60075094 0-1.00125156.4-1.00125156 1s.40050062 1 1.00125156 1h9.61201505l-2.3028786 2.3c-.4005007.4-.4005007 1 0 1.4.2002503.2.5006258.3.7008761.3s.5006257-.1.7008761-.3l4.0050062-4c.1001252-.1.2002503-.2.2002503-.3z"}),Y=function(e){return l.a.createElement("svg",G({height:22,viewBox:"0 0 20 22",width:20},e),X)},Z=(n.p,function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.signout;return t?l.a.createElement(R.Sidebar,null,l.a.createElement("div",{className:L.a.header},l.a.createElement(A.a,Object.assign({},t,{size:64})),l.a.createElement("h2",null,t.username)),l.a.createElement("div",{className:L.a.nav},l.a.createElement(I.a,{to:"/apps",className:L.a.navElement,activeClassName:L.a.active},l.a.createElement(F,{fill:"white",opacity:.8,width:24}),l.a.createElement("p",{className:"label"},"Applications")),l.a.createElement(I.a,{to:"/devices",className:L.a.navElement,activeClassName:L.a.active},l.a.createElement(H,{fill:"white",opacity:.8,width:24}),l.a.createElement("p",{className:"label"},"Appareils")),l.a.createElement(I.a,{to:"/settings",className:L.a.navElement,activeClassName:L.a.active},l.a.createElement(W,{fill:"white",opacity:.8,width:24}),l.a.createElement("p",{className:"label"},"Param\xe8tres"))),l.a.createElement("div",{className:L.a.logout,onClick:n},l.a.createElement("div",{className:L.a.navElement},l.a.createElement(Y,{fill:"white",opacity:.8,width:24}),l.a.createElement("p",{className:"label"},"D\xe9connexion")))):l.a.createElement(d.a,{to:"/"})}}]),t}(l.a.Component)),ee=Object(p.b)(function(e){return{user:e.masq.currentUser}},function(e){return{signout:function(){return e(Object(h.i)())}}})(Z),te=n(43),ne=n(28),ae=n(44),re=n.n(ae),ce=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(i.a)(t).call(this,e))).state={image:"",lastname:"",firstname:"",username:""},n.hasChanged=!1,n.validate=n.validate.bind(Object(o.a)(Object(o.a)(n))),n.isValid=n.isValid.bind(Object(o.a)(Object(o.a)(n))),n.handleKeyUp=n.handleKeyUp.bind(Object(o.a)(Object(o.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.user;e&&this.setState({image:e.image,lastname:e.lastname,firstname:e.firstname,username:e.username})}},{key:"isValid",value:function(e){var t=this.state[e];switch(e){case"lastname":case"firstname":return Object(ne.a)(t);case"image":return!0;case"username":return Object(ne.c)(t);default:return!1}}},{key:"onChange",value:function(e,t){var n=t.target.value.trim();this.hasChanged=!0,this.setState(Object(te.a)({},e,n))}},{key:"onImageChange",value:function(e){var t=this,n=new window.FileReader,a=e.target.files[0];a&&(n.addEventListener("load",function(){t.hasChanged=!0,t.setState({image:n.result})}),n.readAsDataURL(a))}},{key:"validate",value:function(){var e=this;if(this.hasChanged){if(!Object.keys(this.state).every(function(t){return e.isValid(t)}))return this.forceUpdate();this.props.updateUser(this.props.user.id,this.state),this.hasChanged=!1}}},{key:"handleKeyUp",value:function(e){"Enter"===e.key&&this.validate()}},{key:"render",value:function(){var e=this;return this.props.user?l.a.createElement("div",{className:re.a.Settings},l.a.createElement("div",null,l.a.createElement("div",{className:re.a.titleContainer},l.a.createElement("p",{className:"title"},"Vos param\xe8tres d'utilisateur"),l.a.createElement("p",{className:"subtitle"},"Changez vos informations personnelles")),l.a.createElement("div",{className:re.a.profile},l.a.createElement(A.a,{upload:!0,size:192,image:this.state.image,onChange:function(t){return e.onImageChange(t)}}),l.a.createElement("div",{className:re.a.inputs},l.a.createElement(R.TextField,{error:!this.isValid("lastname"),onKeyUp:this.handleKeyUp,defaultValue:this.state.lastname,onChange:function(t){return e.onChange("lastname",t)},label:this.isValid("lastname")?"Nom":"Le nom ne peut \xeatre vide, et ne peut contenir que des caract\xe8res alphanum\xe9riques et des espaces."}),l.a.createElement(R.TextField,{error:!this.isValid("firstname"),onKeyUp:this.handleKeyUp,defaultValue:this.state.firstname,onChange:function(t){return e.onChange("firstname",t)},label:this.isValid("firstname")?"Pr\xe9nom":"Le pr\xe9nom ne peut \xeatre vide, et ne peut contenir que des caract\xe8res alphanum\xe9riques et des espaces."}),l.a.createElement(R.TextField,{error:!this.isValid("username"),onKeyUp:this.handleKeyUp,defaultValue:this.state.username,onChange:function(t){return e.onChange("username",t)},label:this.isValid("username")?"Pseudo (affich\xe9)":"Le pseudo ne doit pas contenir d'espaces, et peut contenir les caract\xe8res sp\xe9ciaux suivants: !?$#@()-*"})))),l.a.createElement("div",{className:re.a.sidebar},l.a.createElement(R.Button,{width:200,secondary:!this.hasChanged,label:"SAUVEGARDER",onClick:this.validate}))):l.a.createElement(d.a,{to:"/"})}}]),t}(l.a.Component),ie=Object(p.b)(function(e){return{user:e.masq.currentUser}},function(e){return{updateUser:function(t,n){return e(Object(h.k)(t,n))}}})(ce),se=n(54),oe=n.n(se),ue=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(i.a)(t).call(this,e))).state={addDevice:!1},n.handleAddDeviceClick=n.handleAddDeviceClick.bind(Object(o.a)(Object(o.a)(n))),n.renderSyncModal=n.renderSyncModal.bind(Object(o.a)(Object(o.a)(n))),n.handleSyncModalClosed=n.handleSyncModalClosed.bind(Object(o.a)(Object(o.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"handleAddDeviceClick",value:function(){this.setState({addDevice:!0})}},{key:"handleSyncModalClosed",value:function(){this.setState({addDevice:!1})}},{key:"renderSyncModal",value:function(){return!!this.state.addDevice&&l.a.createElement(N.d,{onClose:this.handleSyncModalClosed})}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.devices;return t?l.a.createElement("div",{className:oe.a.Devices},l.a.createElement("div",{className:oe.a.main},this.renderSyncModal(),l.a.createElement("p",{className:"title"},"Mes Appareils"),l.a.createElement("p",{className:"subtitle"},"Retrouvez la liste de vos appareils connect\xe9s \xe0 Masq"),n.map(function(e,t){return l.a.createElement("div",{key:t,className:oe.a.Card},l.a.createElement(R.Card,{minHeight:64,title:e.name,color:e.color,description:e.description}))})),l.a.createElement("div",{className:oe.a.sidebar},l.a.createElement(R.Button,{secondary:!0,label:"Ajouter un appareil",onClick:this.handleAddDeviceClick}))):l.a.createElement(d.a,{to:"/"})}}]),t}(l.a.Component),le=Object(p.b)(function(e){return{user:e.masq.currentUser,devices:e.masq.devices}})(ue);n.d(t,"c",function(){return D}),n.d(t,"a",function(){return q}),n.d(t,"e",function(){return ee}),n.d(t,"d",function(){return ie}),n.d(t,"b",function(){return le})},38:function(e,t,n){e.exports={AuthApp:"AuthApp_AuthApp__2U1N8",title:"AuthApp_title__1pDf1",appTitle:"AuthApp_appTitle__1lopr",description:"AuthApp_description__3EJl0",buttons:"AuthApp_buttons__1L9cS"}},44:function(e,t,n){e.exports={Settings:"Settings_Settings__28zgm",titleContainer:"Settings_titleContainer__21xuE",profile:"Settings_profile__iItWI",inputs:"Settings_inputs__3ibhs",fields:"Settings_fields__bgECp",TextInput:"Settings_TextInput__3I5OA","button-container":"Settings_button-container__O8Z8B",parameters:"Settings_parameters__2JumS",sidebar:"Settings_sidebar__30WIY",appSettings:"Settings_appSettings__bdows",buttons:"Settings_buttons__3g-6r",exportButton:"Settings_exportButton__320ym"}},54:function(e,t,n){e.exports={Devices:"Devices_Devices__3FpT6",main:"Devices_main__CB0P2",Card:"Devices_Card__dkNc-",sidebar:"Devices_sidebar__2ux5H"}},87:function(e,t,n){e.exports={Apps:"Apps_Apps__sNPwb",Card:"Apps_Card__3sq9A"}},91:function(e,t,n){"use strict";(function(e){var a=n(37),r=n(19),c=n(2),i=n.n(c),s=n(6),o=n(9),u=n(10),l=n(84),p=n.n(l),h=n(135),d=n.n(h),f=n(136),m=n.n(f),v=n(85),b=n.n(v),g=n(86),y=n.n(g),O=y.a.crypto,E=O.encrypt,k=O.decrypt,j=O.importKey,w=O.derivePassphrase,_=y.a.utils,C=_.dbReady,S=_.createPromisifiedHyperDB,x="wss://signalhub-jvunerwwrg.now.sh".split(","),A=function(e){var t={config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}};return d()(e,t)},N=function(e){return S(e)},P=function(){function t(){Object(o.a)(this,t),this.profileId=null,this.profileDB=null,this.appsDBs={},this.swarms={},this.hubs={},this.sw=null,this.hub=null,this.key=null,this.peer=null,this.app=null}return Object(u.a)(t,[{key:"openProfile",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Missing profileId");case 2:return this.closeProfile(),this.profileId=t,this.profileDB=N(t),this.profileDB.on("ready",function(){return a._startReplicate(a.profileDB)}),e.next=8,this.getApps();case 8:return e.sent.forEach(function(e){var n=t+"-"+e.id,r=N(n);a.appsDBs[n]=r,r.on("ready",function(){return a._startReplicate(r)})}),e.next=12,this.profileDB.getAsync("/");case 12:return n=e.sent.value,e.abrupt("return",n);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"closeProfile",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stopAllReplicates(),this.profileDB=null,this.profileId=null,this.appsDBs={};case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addProfile",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,c,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=b()(),e.next=3,w(t.password);case 3:return a=e.sent,c={username:t.username,image:t.image,id:n},s=Object(r.a)({},c,{firstname:t.firstname,lastname:t.lastname,hashedPassphrase:a}),o=N(n),e.next=9,C(o);case 9:return e.next=11,o.putAsync("/",s);case 11:this._setProfileToLocalStorage(c);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getProfiles",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._getProfilesFromLocalStorage());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getProfile",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkProfile(),e.next=3,this.profileDB.getAsync("/");case 3:return n=e.sent.value,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateProfile",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,c,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkProfile(),n=t.id){e.next=4;break}throw Error("Missing id");case 4:return e.next=6,this.getProfile(n);case 6:return a=e.sent,c=Object(r.a)({},a,t),s={username:c.username,image:c.image,id:n},e.next=11,this.profileDB.putAsync("/",c);case 11:this._setProfileToLocalStorage(s);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addApp",value:function(e){return this._createResource("apps",e)}},{key:"addDevice",value:function(e){return this._createResource("devices",e)}},{key:"getApps",value:function(){return this._checkProfile(),this._getResources("apps")}},{key:"getDevices",value:function(){return this._checkProfile(),this._getResources("devices")}},{key:"updateApp",value:function(e){return this._checkProfile(),this._updateResource("apps",e)}},{key:"updateDevice",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._updateResource("devices",t);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleUserAppLogin",value:function(){var t=Object(s.a)(i.a.mark(function t(n,a,r){var c=this;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("login : "+n+" ; key : "+a),t.abrupt("return",new Promise(function(){var t=Object(s.a)(i.a.mark(function t(o,u){var l,h;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c.appId=r,c._checkProfile(),t.next=4,j(e.from(a,"base64"));case 4:c.key=t.sent,console.log("app: login: imported key"),l=function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={msg:"authorized",userAppDbId:n},e.next=3,E(c.key,a,"base64");case 3:r=e.sent,t.send(JSON.stringify(r));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={msg:"notAuthorized"},e.next=3,E(c.key,n,"base64");case 3:a=e.sent,t.send(JSON.stringify(a));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c.hub=p()(n,x),c.sw=A(c.hub),console.log("app: login: create swarm, channel : "+n),c.sw.on("disconnect",function(){return c._closeUserAppConnection(),o(!0)}),c.sw.on("peer",function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("app: login: peer connected"),c.peer=t,e.next=4,c.getApps();case 4:n=e.sent,(a=n.find(function(e){return e.appId===r}))?l(t,a.id):h(t),t.once("data",function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,r,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(c.key,JSON.parse(t),"base64");case 2:if(n=e.sent,console.log("app: login: "+n),"connectionEstablished"!==n.msg){e.next=9;break}return c._closeUserAppConnection(),e.abrupt("return",o(!0));case 9:"registerUserApp"===n.msg?(a=n.name,r=n.description,s=n.imageURL,c.app={name:a,description:r,imageURL:s},o(!1)):u(new Error("Invalid data"));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());case 13:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}},t,this)}));return function(e,n,a){return t.apply(this,arguments)}}()},{key:"handleUserAppRegister",value:function(){var t=Object(s.a)(i.a.mark(function t(n){var a=this;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(s.a)(i.a.mark(function t(c,o){var u,l,p,h,d,f,m,v,b;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a._checkProfile(),u="",l=function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={msg:"masqAccessRefused"},e.next=3,E(a.key,n,"base64");case 3:r=e.sent,t.send(JSON.stringify(r));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var c,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c={msg:"masqAccessGranted",key:n,userAppDbId:r},e.next=3,E(a.key,c,"base64");case 3:s=e.sent,t.send(JSON.stringify(s));case 5:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}(),h=function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={msg:"writeAccessGranted"},e.next=3,E(a.key,n,"base64");case 3:r=e.sent,t.send(JSON.stringify(r));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var t=Object(s.a)(i.a.mark(function t(n,r){var s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k(a.key,JSON.parse(r),"base64");case 2:s=t.sent,console.log("app: register: "+s),"requestWriteAccess"===s.msg&&(o=e.from(s.key,"hex"),a.appsDBs[u].authorize(o,function(e){if(e)throw e;return h(n),a.sw.close(),c()}));case 6:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),n){t.next=10;break}return l(a.peer),a.sw.close(),t.abrupt("return",c());case 10:return t.next=12,a.getApps();case 12:if(f=t.sent,!(m=f.find(function(e){return e.appId===a.appId}))){t.next=18;break}t.t0=m.id,t.next=21;break;case 18:return t.next=20,a.addApp(Object(r.a)({},a.app,{appId:a.appId}));case 20:t.t0=t.sent;case 21:v=t.t0,u=a.profileId+"-"+v,b=N(u),a.appsDBs[u]=b,b.on("ready",function(){a._startReplicate(b),p(a.peer,b.key.toString("hex"),v)}),a.peer.on("data",function(e){return d(a.peer,e)});case 27:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_createResource",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,c,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkProfile(),e.next=3,this.profileDB.getAsync("/".concat(t));case 3:return r=e.sent,c=r?r.value:[],s=b()(),n.id=s,o=[{type:"put",key:"/".concat(t),value:[].concat(Object(a.a)(c),[s])},{type:"put",key:"/".concat(t,"/").concat(s),value:n}],e.next=10,this.profileDB.batchAsync(o);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getResources",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,r,c,s,o=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.profileDB.getAsync("/".concat(t));case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:return a=n.value,r=a.map(function(e){return o.profileDB.getAsync("/".concat(t,"/").concat(e))}),e.next=9,Promise.all(r);case 9:return c=e.sent,s=c.map(function(e){return e.value}),e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_updateResource",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.id){e.next=3;break}throw Error("Missing id");case 3:return e.abrupt("return",this.profileDB.putAsync("/".concat(t,"/").concat(a),n));case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setProfileToLocalStorage",value:function(e){var t=e.id;if(!t)throw Error("missing id");window.localStorage.setItem(t,JSON.stringify({id:t,username:e.username,image:e.image}))}},{key:"_getProfilesFromLocalStorage",value:function(){var e=Object.keys(window.localStorage);return e?e.map(function(e){return JSON.parse(window.localStorage.getItem(e))}):[]}},{key:"_startReplicate",value:function(e){var t=e.discoveryKey.toString("hex");console.log("App : channel : "+t),this.hubs[t]=p()(t,x),this.swarms[t]=A(this.hubs[t]),this.swarms[t].on("peer",function(t){var n=e.replicate({live:!0});m()(t,n,t)})}},{key:"_stopAllReplicates",value:function(){Object.values(this.swarms).forEach(function(e){return e.close()}),this.swarms={},this.hubs={}}},{key:"_checkProfile",value:function(){if(!this.profileDB)throw Error("Open a profile first")}},{key:"_closeUserAppConnection",value:function(){var e=this;this.sw.on("close",function(){e.hub=null,e.peer=null,e.app=null}),this.sw.close()}}]),t}();t.a=P}).call(this,n(5).Buffer)}},[[139,2,1]]]);
//# sourceMappingURL=main.e49c62fe.chunk.js.map